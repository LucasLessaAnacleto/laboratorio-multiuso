<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Teste DB (src/js/lib/db/index.js)</title>
</head>
<body>
  <h1>Teste: DB (src/js/lib/db/index.js)</h1>

  <script type="module">
    import db from "../../src/js/lib/db/index.js";

    document.addEventListener("DOMContentLoaded", async () => {
      console.log("ğŸš€ Iniciando testes com o mÃ³dulo db...");

      try {
        // ğŸ” 1. Buscar todos os espaÃ§os
        console.log("ğŸ” SELECT todos os espaÃ§os");
        const todos = await db.space.select();
        console.log("âœ… TODOS OS ESPAÃ‡OS:", todos);

        // ğŸ” 2. Buscar espaÃ§os por filtro (departamento)
        console.log("ğŸ” SELECT com filtro");
        const filtrados = await db.space.select({ departamento: "Tecnologia" });
        console.log("âœ… ESPAÃ‡OS FILTRADOS:", filtrados);

        // ğŸ“¨ 4. Inserir novo espaÃ§o com UPSERT
        console.log("ğŸ“¨ UPSERT novo espaÃ§o");
        const novoEspaco = {
          nome: "LaboratÃ³rio de Teste",
          endereco: "PrÃ©dio A",
          contato: "48999999999",
          disponibilidade: "Seg-Sex 8h Ã s 18h",
          departamento: "InformÃ¡tica",
          politica_uso: "Agendar com 1 dia de antecedÃªncia",
          nr_sala: "204",
          nr_andar: "2",
          imagem_url: "https://via.placeholder.com/150"
        };
        const inserido = await db.space.upsert(novoEspaco);
        console.log("âœ… INSERIDO:", inserido);

        const id = inserido[0]?.id;
        if (!id) throw new Error("âŒ ID nÃ£o retornado apÃ³s upsert");

        // ğŸ” 5. Buscar espaÃ§o por ID
        console.log(`ğŸ” SELECT por ID (${id})`);
        const porId = await db.space.selectId(id);
        console.log("âœ… ESPAÃ‡O POR ID:", porId);

        // ğŸ›  6. Atualizar nome do espaÃ§o
        console.log("ğŸ›  PATCH no espaÃ§o");
        const atualizado = await db.space.patch({ id }, { nome: "LaboratÃ³rio Atualizado" });
        console.log("âœ… ATUALIZADO:", atualizado);

        // ğŸ—‘ 7. Deletar espaÃ§o
        console.log("ğŸ—‘ DELETE espaÃ§o");
        const deletado = await db.space.delete({ id });
        console.log("âœ… DELETADO:", deletado);

      } catch (err) {
        console.error("âŒ Erro durante os testes:", err.message);
      }
    });
  </script>
</body>
</html>
